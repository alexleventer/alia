<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>qbits.alia.policy.retry documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Alia-all</span> <span class="project-version">4.1.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>qbits</span></div></div></li><li class="depth-2"><a href="qbits.alia.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>alia</span></div></a></li><li class="depth-3 branch"><a href="qbits.alia.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3 branch"><a href="qbits.alia.cluster-options.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cluster-options</span></div></a></li><li class="depth-3"><a href="qbits.alia.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-4 branch"><a href="qbits.alia.codec.default.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>default</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>extension</span></div></div></li><li class="depth-5"><a href="qbits.alia.codec.extension.joda-time.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda-time</span></div></a></li><li class="depth-4"><a href="qbits.alia.codec.udt-aware.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>udt-aware</span></div></a></li><li class="depth-3 branch"><a href="qbits.alia.enum.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>enum</span></div></a></li><li class="depth-3 branch"><a href="qbits.alia.manifold.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>manifold</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>policy</span></div></div></li><li class="depth-4 branch"><a href="qbits.alia.policy.address-translator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>address-translator</span></div></a></li><li class="depth-4 branch"><a href="qbits.alia.policy.load-balancing.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>load-balancing</span></div></a></li><li class="depth-4 branch"><a href="qbits.alia.policy.reconnection.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>reconnection</span></div></a></li><li class="depth-4 branch current"><a href="qbits.alia.policy.retry.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>retry</span></div></a></li><li class="depth-4"><a href="qbits.alia.policy.speculative-execution.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>speculative-execution</span></div></a></li><li class="depth-3 branch"><a href="qbits.alia.query-logger.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>query-logger</span></div></a></li><li class="depth-3 branch"><a href="qbits.alia.timestamp-generator.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timestamp-generator</span></div></a></li><li class="depth-3 branch"><a href="qbits.alia.tuple.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>tuple</span></div></a></li><li class="depth-3 branch"><a href="qbits.alia.udt.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>udt</span></div></a></li><li class="depth-3"><a href="qbits.alia.uuid.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>uuid</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="qbits.alia.policy.retry.html#var-default-retry-policy"><div class="inner"><span>default-retry-policy</span></div></a></li><li class="depth-1"><a href="qbits.alia.policy.retry.html#var-downgrading-consistency-retry-policy"><div class="inner"><span>downgrading-consistency-retry-policy</span></div></a></li><li class="depth-1"><a href="qbits.alia.policy.retry.html#var-fallthrough-retry-policy"><div class="inner"><span>fallthrough-retry-policy</span></div></a></li><li class="depth-1"><a href="qbits.alia.policy.retry.html#var-logging-retry-policy"><div class="inner"><span>logging-retry-policy</span></div></a></li><li class="depth-1"><a href="qbits.alia.policy.retry.html#var-make"><div class="inner"><span>make</span></div></a></li><li class="depth-1"><a href="qbits.alia.policy.retry.html#var-on-read-timeout"><div class="inner"><span>on-read-timeout</span></div></a></li><li class="depth-1"><a href="qbits.alia.policy.retry.html#var-on-unavailable"><div class="inner"><span>on-unavailable</span></div></a></li><li class="depth-1"><a href="qbits.alia.policy.retry.html#var-on-write-timeout"><div class="inner"><span>on-write-timeout</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">qbits.alia.policy.retry</h1><div class="doc"><div class="markdown"><p>A policy that defines a default behavior to adopt when a request returns a TimeoutException or an UnavailableException. Such policy allows to centralize the handling of query retries, allowing to minimize the need for exception catching/handling in business code.</p></div></div><div class="public anchor" id="var-default-retry-policy"><h3>default-retry-policy</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The default retry policy.</p>
<p>This policy retries queries in only two cases:</p>
<p>On a read timeout, if enough replica replied but data was not retrieved. On a write timeout, if we timeout while writing the distributed log used by batch statements.</p>
<p>This retry policy is conservative in that it will never retry with a different consistency level than the one of the initial operation.</p>
<p>In some cases, it may be convenient to use a more aggressive retry policy like <code>downgrading-consistency-retry-policy</code></p>
<p><a href="http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/DefaultRetryPolicy.html">http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/DefaultRetryPolicy.html</a></p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/modules/alia/src/qbits/alia/policy/retry.clj#L17">view source</a></div></div><div class="public anchor" id="var-downgrading-consistency-retry-policy"><h3>downgrading-consistency-retry-policy</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A retry policy that sometimes retry with a lower consistency level than the one initially requested.</p>
<p>BEWARE: This policy may retry queries using a lower consistency level than the one initially requested. By doing so, it may break consistency guarantees. In other words, if you use this retry policy, there is cases (documented below) where a read at QUORUM may not see a preceding write at QUORUM. Do not use this policy unless you have understood the cases where this can happen and are ok with that. It is also highly recommended to always wrap this policy into LoggingRetryPolicy to log the occurrences of such consistency break.</p>
<p>This policy implements the same retries than the DefaultRetryPolicy policy. But on top of that, it also retries in the following cases:</p>
<p>On a read timeout: if the number of replica that responded is greater than one but lower than is required by the requested consistency level, the operation is retried at a lower consistency level. On a write timeout: if the operation is an WriteType.UNLOGGED_BATCH and at least one replica acknowledged the write, the operation is retried at a lower consistency level.</p>
<p>Furthermore, for other operation, if at least one replica acknowledged the write, the timeout is ignored. On an unavailable exception: if at least one replica is alive, the operation is retried at a lower consistency level. The reasoning being this retry policy is the following one. If, based on the information the Cassandra coordinator node returns, retrying the operation with the initially requested consistency has a change to succeed, do it. Otherwise, if based on these information we know the initially requested consistency level cannot be achieve currently, then:</p>
<p>For writes, ignore the exception (thus silently failing the consistency requirement) if we know the write has been persisted on at least one replica.</p>
<p>For reads, try reading at a lower consistency level (thus silently failing the consistency requirement). In other words, this policy implements the idea that if the requested consistency level cannot be achieved, the next best thing for writes is to make sure the data is persisted, and that reading something is better than reading nothing, even if there is a risk of reading stale data.</p>
<p><a href="http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/DowngradingConsistencyRetryPolicy.html">http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/DowngradingConsistencyRetryPolicy.html</a></p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/modules/alia/src/qbits/alia/policy/retry.clj#L45">view source</a></div></div><div class="public anchor" id="var-fallthrough-retry-policy"><h3>fallthrough-retry-policy</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>A retry policy that never retry (nor ignore).</p>
<p>All of the methods of this retry policy unconditionally return RetryPolicy.RetryDecision.rethrow(). If this policy is used, retry will have to be implemented in business code.</p>
<p><a href="http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/FallthroughRetryPolicy.html">http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/FallthroughRetryPolicy.html</a></p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/modules/alia/src/qbits/alia/policy/retry.clj#L35">view source</a></div></div><div class="public anchor" id="var-logging-retry-policy"><h3>logging-retry-policy</h3><div class="usage"><code>(logging-retry-policy retry-policy)</code></div><div class="doc"><div class="markdown"><p>A retry policy that wraps another policy, logging the decision made by its sub-policy.</p>
<p>Note that this policy only log the IGNORE and RETRY decisions (since RETHROW decisions are just meant to propagate the cassandra exception).</p>
<p>The logging is done at the INFO level.</p>
<p><a href="http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/LoggingRetryPolicy.html">http://www.datastax.com/drivers/java/apidocs/com/datastax/driver/core/policies/LoggingRetryPolicy.html</a></p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/modules/alia/src/qbits/alia/policy/retry.clj#L94">view source</a></div></div><div class="public anchor" id="var-make"><h3>make</h3><h4 class="type">multimethod</h4><div class="usage"></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/modules/alia/src/qbits/alia/policy/retry.clj#L144">view source</a></div></div><div class="public anchor" id="var-on-read-timeout"><h3>on-read-timeout</h3><div class="usage"><code>(on-read-timeout policy query consistency required-responses received-responses data-retrieved? nb-retry)</code></div><div class="doc"><div class="markdown"><p>Defines whether to retry and at which consistency level on a read timeout.</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/modules/alia/src/qbits/alia/policy/retry.clj#L108">view source</a></div></div><div class="public anchor" id="var-on-unavailable"><h3>on-unavailable</h3><div class="usage"><code>(on-unavailable policy query consistency required-responses required-replica alive-responses nb-retry)</code></div><div class="doc"><div class="markdown"><p>Defines whether to retry and at which consistency level on an unavailable exception.</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/modules/alia/src/qbits/alia/policy/retry.clj#L120">view source</a></div></div><div class="public anchor" id="var-on-write-timeout"><h3>on-write-timeout</h3><div class="usage"><code>(on-write-timeout policy query consistency write-type required-acks received-acks nb-retry)</code></div><div class="doc"><div class="markdown"><p>Defines whether to retry and at which consistency level on a write timeout</p></div></div><div class="src-link"><a href="https://github.com/mpenet/alia/blob/master/modules/alia/src/qbits/alia/policy/retry.clj#L132">view source</a></div></div></div></body></html>